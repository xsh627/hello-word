<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>快递计算工具</title>
  <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.7.1/jquery.js"></script>
  <style>
    * {
      padding: 0;
      margin: 0;
    }
    .form-item {
      margin: 10px 10px 0;
    }
    .btn-box {
      display: flex;
      justify-content: center;
    }
    .ope-btn {
      padding: 10px;
      margin: 0 20px;
      font-size: 20px;
    }
    #result {
      color: #f00;
      font-size: 20px;
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <div class="params-form">
      <div class="form-item">
        <label for="">SKU：</label>
        <select name="" id="product">
          <option value="-1">无</option>
        </select>
      </div>
      <div class="form-item">
        <label for="">地区：</label>
        <select name="" id="area"></select>
      </div>
      <div class="form-item">
        <label for="">个数：</label>
        <input type="text" class="input-num" id="inputAmount">
      </div>
      <div class="form-item">
        <label for="">0.1kg以内</label>
        <input type="text" class="input-lvl-price" id="inputLvlPrice1">
      </div>
      <div class="form-item">
        <label for="">0.1kg~0.3kg</label>
        <input type="text" class="input-lvl-price" id="inputLvlPrice2">
      </div>
      <div class="form-item">
        <label for="">0.31kg~0.5kg</label>
        <input type="text" class="input-lvl-price" id="inputLvlPrice3">
      </div>
      <div class="form-item">
        <label for="">超0.5kg续重每0.5kg</label>
        <input type="text" class="input-lvl-price" id="inputLvlPrice4">
      </div>
      <div class="form-item">
        <label for="">3kg以上</label>
        <input type="text" class="input-lvl-price" id="inputLvlPrice5">
      </div>
      <div class="form-item">
        <strong>个重：<span id="singleWeight">-</span>kg</strong>
      </div>
      <div class="form-item">
        <strong>总重：<span id="totalWeight">-</span>kg</strong>
      </div>
      <div class="form-item">
        <strong>所需快递费（参考值）：<span id="result">-</span>元</strong>
      </div>
      <div class="form-item">
        <div class="btn-box">
          <button class="ope-btn" id="calcBtn">计算</button>
          <button class="ope-btn" id="resetBtn">重置</button>
        </div>
      </div>
    </div>
  </div>
  <script>
    $(function () {
      const options = [
        {
          id: 'fanhuasheng-1',
          label: '翻花绳-1条',
          weight: 0.0075,
          price: 1.8
        },
        {
          id: 'fanhuasheng-5',
          label: '翻花绳-5条',
          weight: 0.0375,
          price: 3.52
        },
        {
          id: 'caihongquan-dahao',
          label: '彩虹圈-大号',
          weight: 0.115,
          price: 4.5
        },
        {
          id: 'caihongquan-zhonghao',
          label: '彩虹圈-中号',
          weight: 0.045,
          price: 3.5
        },
        {
          id: 'zhongbiaomoxing',
          label: '钟表模型',
          weight: 0.05,
          price: 3.5
        },
        {
          id: 'makalong-sanjie',
          label: '魔方-二阶',
          weight: 0.06,
          price: 4.4
        },
        {
          id: 'makalong-sanjie',
          label: '魔方-三阶',
          weight: 0.075,
          price: 3.2
        },
        {
          id: 'makalong-sanjie',
          label: '魔方-四阶',
          weight: 0.115,
          price: 12.4
        },
        {
          id: 'makalong-sanjie',
          label: '魔方-五阶',
          weight: 0.115,
          price: 15.4
        },
        {
          id: 'makalong-sanjie',
          label: '魔方-金字塔',
          weight: 0.065,
          price: 8.4
        },
        {
          id: 'makalong-sanjie',
          label: '魔方-圣手/传奇',
          weight: 0.065,
          price: 3
        },
        {
          id: 'pinghengtaikongren-lanse',
          label: '平衡太空人-蓝色',
          weight: 0.18,
          price: 5.5
        },
        {
          id: 'pinghengtaikongren-huangse',
          label: '平衡太空人-黄色',
          weight: 0.185,
          price: 5.5
        }
      ]
      const areaData = [
        {
          id: 'guangdong',
          label: '广东',
          price: 2
        },
        {
          id: 'fujian',
          label: '福建',
          price: 2.5
        },
        {
          id: 'guangxi',
          label: '广西',
          price: 2.5
        },
        {
          id: 'jiangxi',
          label: '江西',
          price: 2.5
        },
        {
          id: 'hunan',
          label: '湖南',
          price: 2.5
        },
        {
          id: 'hubei',
          label: '湖北',
          price: 2.5
        },
        {
          id: 'jiangsu',
          label: '江苏',
          price: 2.5
        },
        {
          id: 'zhejiang',
          label: '浙江',
          price: 2.5
        },
        {
          id: 'shanghai',
          label: '上海',
          price: 3
        },
        {
          id: 'anhui',
          label: '安徽',
          price: 2.5
        },
        {
          id: 'henan',
          label: '河南',
          price: 3.5
        },
        {
          id: 'beijing',
          label: '北京',
          price: 4
        },
        {
          id: 'tianjin',
          label: '天津',
          price: 3.5
        },
        {
          id: 'hainan',
          label: '海南',
          price: 4
        },
        {
          id: 'guizhou',
          label: '贵州',
          price: 3.5
        },
        {
          id: 'yunnan',
          label: '云南',
          price: 3.5
        },
        {
          id: 'hebei',
          label: '河北',
          price: 3.5
        },
        {
          id: 'chongqing',
          label: '重庆',
          price: 3.5
        },
        {
          id: 'sichuan',
          label: '四川',
          price: 3.5
        },
        {
          id: 'shandong',
          label: '山东',
          price: 3.5
        },
        {
          id: 'shanxi',
          label: '陕西',
          price: 3.5
        },
        {
          id: 'shanxi',
          label: '山西',
          price: 3.5
        },
        {
          id: 'liaoning',
          label: '辽宁',
          price: 4
        },
        {
          id: 'jilin',
          label: '吉林',
          price: 4
        },
        {
          id: 'heilongjiang',
          label: '黑龙江',
          price: 4
        },
        {
          id: 'ningxia',
          label: '宁夏',
          price: 6
        },
        {
          id: 'qinghai',
          label: '青海',
          price: 6
        },
        {
          id: 'gansu',
          label: '甘肃',
          price: 6
        },
        {
          id: 'neimenggu',
          label: '内蒙古',
          price: 6
        },
        {
          id: 'xinjiang',
          label: '新疆',
          price: 0
        },
        {
          id: 'xizang',
          label: '西藏',
          price: 0
        }
      ]
      const optionMap = {}
      const areaMap = {}
      const farAreas = [
        'xinjiang',
        'xizang'
      ]
      const $selectOfProduct = $('#product')
      const $selectOfArea = $('#area')
      const $inputAmount = $('#inputAmount')
      const $inputLvlPrice1 = $('#inputLvlPrice1')
      const $inputLvlPrice2 = $('#inputLvlPrice2')
      const $inputLvlPrice3 = $('#inputLvlPrice3')
      const $inputLvlPrice4 = $('#inputLvlPrice4')
      const $inputLvlPrice5 = $('#inputLvlPrice5')
      const $singleWeight = $('#singleWeight')
      const $totalWeight = $('#totalWeight')
      const $result = $('#result')

      const $calcBtn = $('#calcBtn')
      const $resetBtn = $('#resetBtn')

      init()

      initEvent()

      function init () {
        let optionsHtml = '<option value="-1">无</option>'
        options.forEach(function (optionItem) {
          console.log('item===', optionItem)
          optionsHtml += `<option value="${optionItem.id}">${optionItem.label}</option>`
          const noNeedKeys = ['id']
          optionMap[optionItem.id] = {}
          for (let key in optionItem) {
            if (!noNeedKeys.includes(key)) {
              optionMap[optionItem.id][key] = optionItem[key]
            }
          }
        })
        $selectOfProduct.html(optionsHtml)
        console.log('optionMap===', optionMap)
        let areaOptionsHtml = ''
        areaData.forEach(function (areaItem) {
          areaOptionsHtml += `<option value="${areaItem.id}">${areaItem.label}</option>`
          areaMap[areaItem.id] = {}
          for (let key in areaItem) {
            if (!['id'].includes(key)) {
              areaMap[areaItem.id][key] = areaItem[key]
            }
          }
        })
        console.log('areaMap===', areaMap)
        $selectOfArea.html(areaOptionsHtml)
        $inputAmount.val(1)
        $inputLvlPrice1.val(1.7)
        $inputLvlPrice2.val(0.2)
        $inputLvlPrice3.val(0.4)
        $inputLvlPrice4.val(0.7)
        $inputLvlPrice5.val(2)
        $result.html('-')
      }

      function initEvent () {
        $selectOfProduct.on('change', weightRelateChangeHandle)
        $selectOfArea.on('change', areaChangeHandle)
        $inputAmount.on('input', weightRelateChangeHandle)
        $calcBtn.on('click', calculate)
        $resetBtn.on('click', init)
        $selectOfArea.trigger('change')
      }

      function weightRelateChangeHandle () {
        const productId = $selectOfProduct.val()
        if (productId === '-1') return

        const num = Number($inputAmount.val())
        if (isNaN(num)) return

        const singleWeight = optionMap[productId].weight
        const totalWeight = (singleWeight * num).toFixed(3)
        $singleWeight.html(singleWeight)
        $totalWeight.html(totalWeight)
      }

      function areaChangeHandle () {
        const areaId = $selectOfArea.val()
        const selectedAreaData = areaMap[areaId]
        if (selectedAreaData) {
          $inputLvlPrice5.val(Number(selectedAreaData.price))
        }
      }

      function calculate () {
        const productId = $selectOfProduct.val()
        console.log('productId===', productId, typeof productId)

        if (['', '-1'].includes(productId)) {
          console.log('请选择产品')
          return
        }

        const productData = optionMap[productId]
        if (!productData) {
          console.log('找不到对应产品数据')
          return
        }

        const amount = Number($inputAmount.val())
        const singleWeight = Number(productData.weight)
        const weight = singleWeight * amount
        let result = 0

        const lvlPrice1 = Number($inputLvlPrice1.val())
        const lvlPrice2 = Number($inputLvlPrice2.val())
        const lvlPrice3 = Number($inputLvlPrice3.val())
        const lvlPrice4 = Number($inputLvlPrice4.val())
        const lvlPrice5 = Number($inputLvlPrice5.val())

        let times

        const areaId = $selectOfArea.val()
        console.log('areaId===', areaId)
        if (farAreas.includes(areaId)) {
          if (weight > 0.5) {
            times = Math.ceil(weight/0.5)
            result = times * 5
          } else {
            result = 3
            if (weight > 0.3) {
              result += 5
            }
          }
        } else {
          if (weight > 3) {
            times = Math.ceil(weight/1)
            result = times * lvlPrice5
          } else {
            result = lvlPrice1
            if (weight > 0.1) {
              result += lvlPrice2

              if (weight > 0.3) {
                result += lvlPrice3
              }
              if (weight > 0.5) {
                let overWeight = weight - 0.5
                overWeight = overWeight > 2.5 ? 2.5 : overWeight
                const overTimes = Math.ceil(overWeight/0.5)
                result += lvlPrice4 * overTimes
              }
            }
          }
        }
        
        console.log('result===', result)
        result = result.toFixed(2)
        $result.html(result)
      }
    })
  </script>
</body>
</html>